<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Custom QR Code Generator</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			text-align: center;
			margin: 20px;
		}

		#qrcode {
			margin-top: 20px;
			position: relative;
			display: inline-block;
		}

		input,
		button,
		label {
			padding: 10px;
			margin: 10px;
			font-size: 16px;
		}

		#download {
			display: none;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
	<h2>Custom QR Code Generator</h2>

	<input type="text" id="text" placeholder="Enter text or URL"><br>

	<label>Foreground Color:</label>
	<input type="color" id="foregroundColor" value="#000000"><br>

	<label>Background Color:</label>
	<!-- <input type="color" id="backgroundColor" value="#ffffff"> -->
	<input type="color" id="backgroundColor" value="#61C2A2">
	<label><input type="checkbox" id="transparentBackground"> Transparent</label><br>

	<label>Upload Logo (Optional):</label>
	<input type="file" id="logoUpload" accept="image/*"><br>

	<label>Logo Position:</label><br>
	<input type="radio" name="logoPosition" value="center" checked> Center
	<input type="radio" name="logoPosition" value="top-left"> Top Left
	<input type="radio" name="logoPosition" value="top-right"> Top Right
	<input type="radio" name="logoPosition" value="bottom-left"> Bottom Left
	<input type="radio" name="logoPosition" value="bottom-right"> Bottom Right
	<br>

	<button onclick="generateQR()">Generate QR Code</button>

	<div id="qrcode"></div>
	<br>
	<a id="download" download="custom_qrcode.png">
		<button>Download QR Code</button>
	</a>

	<script>
		function generateQR() {
			let text = document.getElementById("text").value.trim();
			let foregroundColor = document.getElementById("foregroundColor").value;
			let backgroundColor = document.getElementById("backgroundColor").value;
			let isTransparent = document.getElementById("transparentBackground").checked;
			let logoInput = document.getElementById("logoUpload");
			let qrContainer = document.getElementById("qrcode");
			let downloadBtn = document.getElementById("download");

			qrContainer.innerHTML = ""; // Clear previous QR codes
			downloadBtn.style.display = "none";

			if (text === "") {
				alert("Please enter some text.");
				return;
			}

			// Generate QR Code
			let qr = new QRCode(qrContainer, {
				text: text,
				width: 300,
				height: 300,
				correctLevel: QRCode.CorrectLevel.H
			});

			// Wait for QR code to render, then modify it
			setTimeout(() => {
				let canvas = qrContainer.querySelector("canvas");
				if (!canvas) return;

				let ctx = canvas.getContext("2d");
				let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
				let data = imageData.data;

				// Apply foreground/background colors
				for (let i = 0; i < data.length; i += 4) {
					let isBlack = data[i] < 128 && data[i + 1] < 128 && data[i + 2] < 128;
					if (isBlack) {
						data[i] = parseInt(foregroundColor.slice(1, 3), 16);
						data[i + 1] = parseInt(foregroundColor.slice(3, 5), 16);
						data[i + 2] = parseInt(foregroundColor.slice(5, 7), 16);
					} else {
						if (isTransparent) {
							data[i + 3] = 0; // Make transparent
						} else {
							data[i] = parseInt(backgroundColor.slice(1, 3), 16);
							data[i + 1] = parseInt(backgroundColor.slice(3, 5), 16);
							data[i + 2] = parseInt(backgroundColor.slice(5, 7), 16);
						}
					}
				}

				ctx.putImageData(imageData, 0, 0);

				// If a logo is uploaded, add it at selected position
				if (logoInput.files.length > 0) {
					let logo = new Image();
					logo.src = URL.createObjectURL(logoInput.files[0]);
					logo.onload = function () {
						let logoSize = canvas.width * 0.1; // 10% of QR code size
						let position = document.querySelector('input[name="logoPosition"]:checked').value;
						let x, y;

						// Determine logo position
						switch (position) {
							case "top-left":
								x = 10;
								y = 10;
								// x = 0;
								// y = 0;
								break;
							case "top-right":
								x = canvas.width - logoSize - 10;
								y = 10;
								break;
							case "bottom-left":
								x = 10;
								y = canvas.height - logoSize - 10;
								break;
							case "bottom-right":
								x = canvas.width - logoSize - 10;
								y = canvas.height - logoSize - 10;
								break;
							default: // Center
								x = (canvas.width - logoSize) / 2;
								y = (canvas.height - logoSize) / 2;
						}

						// Draw circular mask
						// ctx.save();
						// ctx.beginPath();
						// ctx.arc(x + logoSize / 2, y + logoSize / 2, logoSize / 2, 0, Math.PI * 2);
						// ctx.closePath();
						// ctx.clip();

						// Draw the logo
						ctx.drawImage(logo, x, y, logoSize, logoSize);

						// Restore the canvas state
						ctx.restore();

						// Add white border around the logo
						// ctx.beginPath();
						// ctx.arc(x + logoSize / 2, y + logoSize / 2, logoSize / 2 + 4, 0, Math.PI * 2);
						// ctx.lineWidth = 5;
						// // ctx.strokeStyle = "#ffffff";
						// ctx.strokeStyle = backgroundColor;
						// ctx.stroke();
						// ctx.closePath();

						enableDownload(canvas);
					};
				} else {
					enableDownload(canvas);
				}
			}, 300);
		}

		function enableDownload(canvas) {
			let downloadBtn = document.getElementById("download");
			let qrImage = canvas.toDataURL("image/png");
			downloadBtn.href = qrImage;
			downloadBtn.style.display = "inline-block";
		}
	</script>
</body>

</html>